<!DOCTYPE html>
<html>
<head>
    <title>bird</title>
    <style type="text/css">
        @font-face {
            font-family: 'Flappy Bird';
            src: url('fonts/FB.eot');
            src: url('fonts/FB.eot?#iefix') format('embedded-opentype'),
                 url('fonts/FB.woff') format('woff'),
                 url('fonts/FB.ttf') format('truetype'),
                 url('fonts/FB.svg#04b_19regular') format('svg');
            font-weight: normal;
            font-style: normal;
        }
        body, html {
            margin: 0px;
            padding: 0px;
            text-align: center;
            height: 100%;
        }
        canvas {
            margin-bottom: -4px;
            height: 100%;
        }
    </style>
    <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
    <script type="text/javascript">
    var stage, messageField, preload, canvas, floorImage, manifest, background, width, height, imStupidBird;
    var ground;
    var stageName = 'bg';

    function init()
    {
        //canvas
        canvas = document.getElementById(stageName);
        //create stage
        stage = new createjs.Stage(stageName);
        //setting message
        settingMessageField();
        // grab canvas width and height for later calculations:
        width = stage.canvas.width;
        height = stage.canvas.height;
        //images
        manifest = [
            {src:"img/bird.png", id:"bird"},
            {src:"img/background.png", id:"background"},
            {src:"img/ground.png", id:"ground"},
            {src:"img/pipe.png", id:"pipe"},
            {src:"img/restart.png", id:"start"},
            {src:"img/share.png", id:"share"}
        ];

        preload = new createjs.LoadQueue();
        //events
        preload.addEventListener("progress", updateLoading);
        preload.addEventListener("complete", doneLoading);
        //setting Add files you want to load
        preload.loadManifest(manifest);
    }

    function updateLoading()
    {
        //preload.progress = 0~100%
        messageField.text = "Loading " + (preload.progress * 100) + "%";
        stage.update();
    }

    function doneLoading()
    {
        //clearInterval(loadingInterval);
        messageField.text = "Click to start";
        stage.update();

        canvas.onclick = handleStart;
    }

    function handleStart()
    {
        //remove text
        stage.removeAllChildren();

        background = new createjs.Shape();
        //fill in img background drawRect(x, y, w, h)
        background.graphics.beginBitmapFill(preload.getResult('background')).drawRect(0,0,width,height);

        stage.addChild(background);

        //groud create
        var groundImg = preload.getResult('ground');
        ground = new createjs.Shape();
        ground.graphics.beginBitmapFill(groundImg).drawRect(0, 0, width, groundImg.height);
        ground.y = height - groundImg.height;

        //groud2 create
        ground2 = new createjs.Shape();
        ground2.graphics.beginBitmapFill(groundImg).drawRect(0, 0, width, groundImg.height);
        ground2.y = height - groundImg.height;
        ground2.x = ground.x + width;
        stage.addChild(ground, ground2);

        //stupid bird (SpriteSheet = play image)
        var stupidBird = new createjs.SpriteSheet({
            'images': [preload.getResult('bird')],
            //set center and size of frames, center is important for later bird roation
            "frames": {"width": 92, "height": 64, "regX": 46, "regY": 32, "count": 3},
            // define two animations, run (loops, 0.21x speed) and dive (returns to dive and holds frame one static):
            "animations": {"fly": [0, 2, "fly", 0.21], "dive": [1, 1, "dive", 1]}
        });

        //bird is created (Sprite = show SpriteSheet)
        imStupidBird = new createjs.Sprite(stupidBird, "fly");

        var startX = width / 2 - 100;
        var startY = 512;

        imStupidBird.setTransform(startX, startY, 1, 1);
        // Set framerate
        imStupidBird.framerate = 30;

        // Use a tween to wiggle the bird up and down using a sineInOut Ease
        createjs.Tween.get(imStupidBird, {loop:true})
            .to( {y:startY + 100}, 380, createjs.Ease.sineInOut)
            .to( {y:startY}, 380, createjs.Ease.sineInOut);
        stage.addChild(imStupidBird);
        //jump
        stage.addEventListener("stagemousedown", handleJumpStart);

        //tick
        createjs.Ticker.addEventListener("tick", tick);
    }

    function handleJumpStart()
    {

    }

    function tick(event)
    {
        if (ground2.x <= 0) {
            ground.x = 0;
            ground2.x = ground.x + width;
        } else {
            ground.x = ground.x - 10;
            ground2.x = ground2.x - 10;
        }
        stage.update();
    }

    function settingMessageField()
    {
        messageField = new createjs.Text("Loading", "bold 24px", "#333");
        messageField.maxWidth = 1000;
        messageField.textAlign = 'center';
        messageField.x = canvas.width / 2;
        messageField.y = canvas.height / 2;
        stage.addChild(messageField);
        stage.update();
    }
    </script>
</head>
<body onload="init();">
    <canvas id="bg" width="768" height="1024"></canvas>
</body>
</html>